<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>psychopy_legacy.visual.ratingscale &#8212; PsychoPy Example Plugin 0.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=536c50fe" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/psychopy.css?v=b9f4e6dd" />
    <script src="../../../../_static/documentation_options.js?v=d20be8f5"></script>
    <script src="../../../../_static/doctools.js?v=b682be12"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script src="../../../../_static/js/jquery-fix.js"></script>
    <script src="../../../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script src="../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../../../genindex/" />
    <link rel="search" title="Search" href="../../../../search/" />
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
    <meta name="apple-mobile-web-app-capable" content="yes">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-4089651-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-4089651-2');
    </script>

    <!-- Matomo -->
    <script>
      var _paq = window._paq = window._paq || [];
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
      _paq.push(["setCookieDomain", "*.psychopy.org"]);
      _paq.push(["setDomains", ["*.psychopy.org","*.discourse.psychopy.org"]]);
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//analytics.opensciencetools.org/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '3']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <noscript><p><img src="//analytics.opensciencetools.org/matomo.php?idsite=3&amp;rec=1" style="border:0;" alt="" /></p></noscript>
    <!-- End Matomo Code -->


  </head><body>

<!-- The social media icon bar -->
<div class="social-bar">
  <a href="" class="github">
    <i class="fab fa-github"></i></a>
</div>


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand small-logo" href="../../../../">
          <img src="../../../../_static/Psychopy Plugin Header Small.png" alt="PsychoPy Logo">
        </a>
        <a class="navbar-brand large-logo" href="../../../../">
          <img src="../../../../_static/Psychopy Plugin Header Large.png" alt="PsychoPy Logo">
        </a>
        <!-- <span class="navbar-text navbar-version pull-right"><b></b></span> -->
      </div>

        <div class="collapse navbar-collapse nav-collapse w-100 pull-right">
          <ul class="nav navbar-nav ml-auto">
            <li><a href="../../../../">Home</a></li>
            <li><a href="../../../../download/">Install</a></li>
            
            <li><a href="https://plugins.psychopy.org/directory.html" class="return-btn">plugins.psychopy.org</a></li>
            
              <!-- <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../../">Documentation <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption" role="heading"><span class="caption-text">Added content for Builder</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../builder/components/PatchComponent/">PatchComponent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../builder/components/RatingScaleComponent/">RatingScaleComponent</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Added content for Coder</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../coder/MovieStim2/">MovieStim2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../coder/MovieStim3/">MovieStim3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../coder/PatchStim/">PatchStim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../coder/RatingScale/">RatingScale</a></li>
</ul>
</ul>
</li> -->
              
            
            <!--  -->
            
            
          </ul>

            <!-- 
              
<form class="navbar-form navbar-right" action="../../../../search/" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
             -->

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-9 content">
      
  <h1>Source code for psychopy_legacy.visual.ratingscale</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;A class for getting numeric or categorical ratings, e.g., a 1-to-7 scale.&quot;&quot;&quot;</span>

<span class="c1"># Part of the PsychoPy library</span>
<span class="c1"># Copyright (C) 2002-2018 Jonathan Peirce (C) 2019-2024 Open Science Tools Ltd.</span>
<span class="c1"># Distributed under the terms of the GNU General Public License (GPL).</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">from</span> <span class="nn">psychopy</span> <span class="kn">import</span> <span class="n">core</span><span class="p">,</span> <span class="n">logging</span><span class="p">,</span> <span class="n">event</span>
<span class="kn">from</span> <span class="nn">psychopy.visual.circle</span> <span class="kn">import</span> <span class="n">Circle</span>
<span class="kn">from</span> <span class="nn">psychopy.visual.patch</span> <span class="kn">import</span> <span class="n">PatchStim</span>
<span class="kn">from</span> <span class="nn">psychopy.visual.shape</span> <span class="kn">import</span> <span class="n">ShapeStim</span>
<span class="kn">from</span> <span class="nn">psychopy.visual.text</span> <span class="kn">import</span> <span class="n">TextStim</span>
<span class="kn">from</span> <span class="nn">psychopy.visual.basevisual</span> <span class="kn">import</span> <span class="n">MinimalStim</span>
<span class="kn">from</span> <span class="nn">psychopy.visual.helpers</span> <span class="kn">import</span> <span class="n">pointInPolygon</span><span class="p">,</span> <span class="n">groupFlipVert</span>
<span class="kn">from</span> <span class="nn">psychopy.tools.attributetools</span> <span class="kn">import</span> <span class="n">logAttrib</span>
<span class="kn">from</span> <span class="nn">psychopy.constants</span> <span class="kn">import</span> <span class="n">FINISHED</span><span class="p">,</span> <span class="n">STARTED</span><span class="p">,</span> <span class="n">NOT_STARTED</span>


<div class="viewcode-block" id="RatingScale">
<a class="viewcode-back" href="../../../../coder/RatingScale/#psychopy_legacy.visual.ratingscale.RatingScale">[docs]</a>
<span class="k">class</span> <span class="nc">RatingScale</span><span class="p">(</span><span class="n">MinimalStim</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class for obtaining ratings, e.g., on a 1-to-7 or categorical scale.</span>
<span class="sd">    This is a lazy-imported class, therefore import using full path </span>
<span class="sd">    `from psychopy.visual.ratingscale import RatingScale` when inheriting</span>
<span class="sd">    from it.</span>

<span class="sd">    A RatingScale instance is a re-usable visual object having a ``draw()``</span>
<span class="sd">    method, with customizable appearance and response options. ``draw()``</span>
<span class="sd">    displays the rating scale, handles the subject&#39;s mouse or key responses,</span>
<span class="sd">    and updates the display. When the subject accepts a selection,</span>
<span class="sd">    ``.noResponse`` goes ``False`` (i.e., there is a response).</span>

<span class="sd">    You can call the ``getRating()`` method anytime to get a rating,</span>
<span class="sd">    ``getRT()`` to get the decision time, or ``getHistory()`` to obtain</span>
<span class="sd">    the entire set of (rating, RT) pairs.</span>

<span class="sd">    There are five main elements of a rating scale: the `scale`</span>
<span class="sd">    (text above the line intended to be a reminder of how to use the scale),</span>
<span class="sd">    the `line` (with tick marks), the `marker` (a moveable visual indicator</span>
<span class="sd">    on the line), the `labels` (text below the line that label specific</span>
<span class="sd">    points), and the `accept` button. The appearance and function of</span>
<span class="sd">    elements can be customized by the experimenter; it is not possible</span>
<span class="sd">    to orient a rating scale to be vertical. Multiple scales can be</span>
<span class="sd">    displayed at the same time, and continuous real-time ratings can be</span>
<span class="sd">    obtained from the history.</span>

<span class="sd">    The Builder RatingScale component gives a restricted set of options,</span>
<span class="sd">    but also allows full control over a RatingScale via the</span>
<span class="sd">    &#39;customize_everything&#39; field.</span>

<span class="sd">    A RatingScale instance has no idea what else is on the screen.</span>
<span class="sd">    The experimenter has to draw the item to be rated, and handle `escape`</span>
<span class="sd">    to break or quit, if desired. The subject can use the mouse or keys to</span>
<span class="sd">    respond. Direction keys (left, right) will move the marker in the</span>
<span class="sd">    smallest available increment (e.g., 1/10th of a tick-mark if</span>
<span class="sd">    precision = 10).</span>

<span class="sd">    **Example 1**:</span>

<span class="sd">        A basic 7-point scale::</span>

<span class="sd">            ratingScale = visual.RatingScale(win)</span>
<span class="sd">            item = &lt;statement, question, image, movie, ...&gt;</span>
<span class="sd">            while ratingScale.noResponse:</span>
<span class="sd">                item.draw()</span>
<span class="sd">                ratingScale.draw()</span>
<span class="sd">                win.flip()</span>
<span class="sd">            rating = ratingScale.getRating()</span>
<span class="sd">            decisionTime = ratingScale.getRT()</span>
<span class="sd">            choiceHistory = ratingScale.getHistory()</span>

<span class="sd">    **Example 2**:</span>

<span class="sd">        For fMRI, sometimes only a keyboard can be used. If your response</span>
<span class="sd">        box sends keys 1-4, you could specify left, right, and accept keys,</span>
<span class="sd">        and not need a mouse::</span>

<span class="sd">            ratingScale = visual.RatingScale(</span>
<span class="sd">                win, low=1, high=5, markerStart=4,</span>
<span class="sd">                leftKeys=&#39;1&#39;, rightKeys = &#39;2&#39;, acceptKeys=&#39;4&#39;)</span>

<span class="sd">    **Example 3**:</span>

<span class="sd">        Categorical ratings can be obtained using choices::</span>

<span class="sd">            ratingScale = visual.RatingScale(</span>
<span class="sd">                win, choices=[&#39;agree&#39;, &#39;disagree&#39;],</span>
<span class="sd">                markerStart=0.5, singleClick=True)</span>

<span class="sd">    For other examples see Coder Demos -&gt; stimuli -&gt; ratingScale.py.</span>

<span class="sd">    :Authors:</span>
<span class="sd">        - 2010 Jeremy Gray: original code and on-going updates</span>
<span class="sd">        - 2012 Henrik Singmann: tickMarks, labels, ticksAboveLine</span>
<span class="sd">        - 2014 Jeremy Gray: multiple API changes (v1.80.00)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">win</span><span class="p">,</span>
                 <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;&lt;default&gt;&#39;</span><span class="p">,</span>
                 <span class="n">choices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">high</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                 <span class="n">precision</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">labels</span><span class="o">=</span><span class="p">(),</span>
                 <span class="n">tickMarks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">tickHeight</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;triangle&#39;</span><span class="p">,</span>
                 <span class="n">markerStart</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">markerColor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">markerExpansion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">singleClick</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">disappear</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">textSize</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">textColor</span><span class="o">=</span><span class="s1">&#39;LightGray&#39;</span><span class="p">,</span>
                 <span class="n">textFont</span><span class="o">=</span><span class="s1">&#39;Helvetica Bold&#39;</span><span class="p">,</span>
                 <span class="n">showValue</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">showAccept</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">acceptKeys</span><span class="o">=</span><span class="s1">&#39;return&#39;</span><span class="p">,</span>
                 <span class="n">acceptPreText</span><span class="o">=</span><span class="s1">&#39;key, click&#39;</span><span class="p">,</span>
                 <span class="n">acceptText</span><span class="o">=</span><span class="s1">&#39;accept?&#39;</span><span class="p">,</span>
                 <span class="n">acceptSize</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">leftKeys</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                 <span class="n">rightKeys</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
                 <span class="n">respKeys</span><span class="o">=</span><span class="p">(),</span>
                 <span class="n">lineColor</span><span class="o">=</span><span class="s1">&#39;White&#39;</span><span class="p">,</span>
                 <span class="n">colorSpace</span><span class="o">=</span><span class="s1">&#39;rgb&#39;</span><span class="p">,</span>
                 <span class="n">skipKeys</span><span class="o">=</span><span class="s1">&#39;tab&#39;</span><span class="p">,</span>
                 <span class="n">mouseOnly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">noMouse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">size</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">stretch</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">minTime</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
                 <span class="n">maxTime</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">flipVert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">autoLog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># catch obsolete args</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :Parameters:</span>

<span class="sd">        win :</span>
<span class="sd">            A :class:`~psychopy.visual.Window` object (required).</span>
<span class="sd">        choices :</span>
<span class="sd">            A list of items which the subject can choose among.</span>
<span class="sd">            ``choices`` takes precedence over ``low``, ``high``,</span>
<span class="sd">            ``precision``, ``scale``, ``labels``, and ``tickMarks``.</span>
<span class="sd">        low :</span>
<span class="sd">            Lowest numeric rating (integer), default = 1.</span>
<span class="sd">        high :</span>
<span class="sd">            Highest numeric rating (integer), default = 7.</span>
<span class="sd">        precision :</span>
<span class="sd">            Portions of a tick to accept as input [1, 10, 60, 100];</span>
<span class="sd">            default = 1 (a whole tick).</span>
<span class="sd">            Pressing a key in `leftKeys` or `rightKeys` will move the</span>
<span class="sd">            marker by one portion of a tick. precision=60 is intended to</span>
<span class="sd">            support ratings of time-based quantities, with seconds being</span>
<span class="sd">            fractional minutes (or minutes being fractional hours).</span>
<span class="sd">            The display uses a colon (min:sec, or hours:min)</span>
<span class="sd">            to signal this to participants. The value returned by getRating()</span>
<span class="sd">            will be a proportion of a minute (e.g., 1:30 -&gt; 1.5, or 59 seconds</span>
<span class="sd">            -&gt; 59/60 = 0.98333). hours:min:sec is not supported.</span>
<span class="sd">        scale :</span>
<span class="sd">            Optional reminder message about how to respond or rate an item,</span>
<span class="sd">            displayed above the line; default =</span>
<span class="sd">            &#39;&lt;low&gt;=not at all, &lt;high&gt;=extremely&#39;.</span>
<span class="sd">            To suppress the scale, set ``scale=None``.</span>
<span class="sd">        labels :</span>
<span class="sd">            Text to be placed at specific tick marks to indicate their value.</span>
<span class="sd">            Can be just the ends (if given 2 labels), ends + middle</span>
<span class="sd">            (if given 3 labels),</span>
<span class="sd">            or all points (if given the same number of labels as points).</span>
<span class="sd">        tickMarks :</span>
<span class="sd">            List of positions at which tick marks should be placed from low</span>
<span class="sd">            to high.</span>
<span class="sd">            The default is to space tick marks equally, one per integer value.</span>
<span class="sd">        tickHeight :</span>
<span class="sd">            The vertical height of tick marks: 1.0 is the default height</span>
<span class="sd">            (above line), -1.0 is below the line, and 0.0 suppresses the</span>
<span class="sd">            display of tickmarks. ``tickHeight`` is purely cosmetic, and can</span>
<span class="sd">            be fractional, e.g., 1.2.</span>
<span class="sd">        marker :</span>
<span class="sd">            The moveable visual indicator of the current selection. The</span>
<span class="sd">            predefined styles are &#39;triangle&#39;, &#39;circle&#39;, &#39;glow&#39;, &#39;slider&#39;,</span>
<span class="sd">            and &#39;hover&#39;. A slider moves smoothly when there are enough</span>
<span class="sd">            screen positions to move through, e.g., low=0, high=100.</span>
<span class="sd">            Hovering requires a set of choices, and allows clicking directly</span>
<span class="sd">            on individual choices; dwell-time is not recorded.</span>
<span class="sd">            Can also be set to a custom marker stimulus: any object with</span>
<span class="sd">            a .draw() method and .pos will work, e.g.,</span>
<span class="sd">            ``visual.TextStim(win, text=&#39;[]&#39;, units=&#39;norm&#39;)``.</span>
<span class="sd">        markerStart :</span>
<span class="sd">            The location or value to be pre-selected upon initial display,</span>
<span class="sd">            either numeric or one of the choices. Can be fractional,</span>
<span class="sd">            e.g., midway between two options.</span>
<span class="sd">        markerColor :</span>
<span class="sd">            Color to use for a predefined marker style, e.g., &#39;DarkRed&#39;.</span>
<span class="sd">        markerExpansion :</span>
<span class="sd">            Only affects the `glow` marker: How much to expand or</span>
<span class="sd">            contract when moving rightward; 0=none, negative shrinks.</span>
<span class="sd">        singleClick :</span>
<span class="sd">            Enable a mouse click to both select and accept the rating,</span>
<span class="sd">            default = ``False``.</span>
<span class="sd">            A legal key press will also count as a singleClick.</span>
<span class="sd">            The &#39;accept&#39; box is visible, but clicking it has no effect.</span>
<span class="sd">        pos : tuple (x, y)</span>
<span class="sd">            Position of the rating scale on the screen. The midpoint of</span>
<span class="sd">            the line will be positioned at ``(x, y)``;</span>
<span class="sd">            default = ``(0.0, -0.4)`` in norm units</span>
<span class="sd">        size :</span>
<span class="sd">            How much to expand or contract the overall rating scale display.</span>
<span class="sd">            Default size = 1.0. For larger than the default, set</span>
<span class="sd">            ``size`` &gt; 1; for smaller, set &lt; 1.</span>
<span class="sd">        stretch:</span>
<span class="sd">            Like ``size``, but only affects the horizontal direction.</span>
<span class="sd">        textSize :</span>
<span class="sd">            The size of text elements, relative to the default size</span>
<span class="sd">            (i.e., a scaling factor, not points).</span>
<span class="sd">        textColor :</span>
<span class="sd">            Color to use for labels and scale text; default = &#39;LightGray&#39;.</span>
<span class="sd">        textFont :</span>
<span class="sd">            Name of the font to use; default = &#39;Helvetica Bold&#39;.</span>
<span class="sd">        showValue :</span>
<span class="sd">            Show the subject their current selection default = ``True``.</span>
<span class="sd">            Ignored if singleClick is ``True``.</span>
<span class="sd">        showAccept :</span>
<span class="sd">            Show the button to click to accept the current value by using</span>
<span class="sd">            the mouse; default = ``True``.</span>
<span class="sd">        acceptPreText :</span>
<span class="sd">            The text to display before any value has been selected.</span>
<span class="sd">        acceptText :</span>
<span class="sd">            The text to display in the &#39;accept&#39; button after a value has</span>
<span class="sd">            been selected.</span>
<span class="sd">        acceptSize :</span>
<span class="sd">            The width of the accept box relative to the default</span>
<span class="sd">            (e.g., 2 is twice as wide).</span>
<span class="sd">        acceptKeys :</span>
<span class="sd">            A list of keys that are used to accept the current response;</span>
<span class="sd">            default = &#39;return&#39;.</span>
<span class="sd">        leftKeys :</span>
<span class="sd">            A list of keys that each mean &quot;move leftwards&quot;;</span>
<span class="sd">            default = &#39;left&#39;.</span>
<span class="sd">        rightKeys :</span>
<span class="sd">            A list of keys that each mean &quot;move rightwards&quot;;</span>
<span class="sd">            default = &#39;right&#39;.</span>
<span class="sd">        respKeys :</span>
<span class="sd">            A list of keys to use for selecting choices, in the desired order.</span>
<span class="sd">            The first item will be the left-most choice, the second</span>
<span class="sd">            item will be the next choice, and so on.</span>
<span class="sd">        skipKeys :</span>
<span class="sd">            List of keys the subject can use to skip a response,</span>
<span class="sd">            default = &#39;tab&#39;.</span>
<span class="sd">            To require a response to every item, set ``skipKeys=None``.</span>
<span class="sd">        lineColor :</span>
<span class="sd">            The RGB color to use for the scale line, default = &#39;White&#39;.</span>
<span class="sd">        mouseOnly :</span>
<span class="sd">            Require the subject to use the mouse (any keyboard input is</span>
<span class="sd">            ignored), default = ``False``. Can be used to avoid competing</span>
<span class="sd">            with other objects for keyboard input.</span>
<span class="sd">        noMouse:</span>
<span class="sd">            Require the subject to use keys to respond; disable and</span>
<span class="sd">            hide the mouse.</span>
<span class="sd">            `markerStart` will default to the left end.</span>
<span class="sd">        minTime :</span>
<span class="sd">            Seconds that must elapse before a response can be accepted,</span>
<span class="sd">            default = `0.4`.</span>
<span class="sd">        maxTime :</span>
<span class="sd">            Seconds after which a response cannot be accepted.</span>
<span class="sd">            If ``maxTime`` &lt;= ``minTime``, there&#39;s no time limit.</span>
<span class="sd">            Default = `0.0` (no time limit).</span>
<span class="sd">        disappear :</span>
<span class="sd">            Whether the rating scale should vanish after a value is accepted.</span>
<span class="sd">            Can be useful when showing multiple scales.</span>
<span class="sd">        flipVert :</span>
<span class="sd">            Whether to mirror-reverse the rating scale in the vertical</span>
<span class="sd">            direction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        <span class="c1"># what local vars are defined (these are the init params) for use by</span>
        <span class="c1"># __repr__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initParams</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RatingScale</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">autoLog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># warn about obsolete arguments; Jan 2014, for v1.80:</span>
        <span class="n">obsoleted</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;showScale&#39;</span><span class="p">,</span> <span class="s1">&#39;ticksAboveLine&#39;</span><span class="p">,</span> <span class="s1">&#39;displaySizeFactor&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;markerStyle&#39;</span><span class="p">,</span> <span class="s1">&#39;customMarker&#39;</span><span class="p">,</span> <span class="s1">&#39;allowSkip&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;stretchHoriz&#39;</span><span class="p">,</span> <span class="s1">&#39;escapeKeys&#39;</span><span class="p">,</span> <span class="s1">&#39;textSizeFactor&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;showScale&#39;</span><span class="p">,</span> <span class="s1">&#39;showAnchors&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;lowAnchorText&#39;</span><span class="p">,</span> <span class="s1">&#39;highAnchorText&#39;</span><span class="p">}</span>
        <span class="n">obsArgs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">obsoleted</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">obsArgs</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;RatingScale obsolete args: </span><span class="si">%s</span><span class="s1">; see changelog v1.80.00&#39;</span>
                   <span class="s1">&#39; for notes on how to migrate&#39;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="nb">list</span><span class="p">(</span><span class="n">obsArgs</span><span class="p">))</span>
            <span class="n">core</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="c1"># kwargs will absorb everything, including typos, so warn about bad</span>
        <span class="c1"># args</span>
        <span class="n">unknownArgs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">obsoleted</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unknownArgs</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;RatingScale unknown kwargs: </span><span class="si">%s</span><span class="s2">&quot;</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="nb">list</span><span class="p">(</span><span class="n">unknownArgs</span><span class="p">))</span>
            <span class="n">core</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">autoLog</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># needs to start off False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span> <span class="o">=</span> <span class="n">win</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disappear</span> <span class="o">=</span> <span class="n">disappear</span>

        <span class="c1"># internally work in norm units, restore to orig units at the end of</span>
        <span class="c1"># __init__:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">savedWinUnits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">setUnits</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span>

        <span class="c1"># &#39;hover&#39; style = like hyperlink with hover over choices:</span>
        <span class="k">if</span> <span class="n">marker</span> <span class="o">==</span> <span class="s1">&#39;hover&#39;</span><span class="p">:</span>
            <span class="n">showAccept</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">singleClick</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">textSize</span> <span class="o">*=</span> <span class="mf">1.5</span>
            <span class="n">mouseOnly</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">noMouse</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">colorSpace</span> <span class="o">=</span> <span class="n">colorSpace</span>

        <span class="c1"># make things well-behaved if the requested value(s) would be trouble:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initFirst</span><span class="p">(</span><span class="n">showAccept</span><span class="p">,</span> <span class="n">mouseOnly</span><span class="p">,</span> <span class="n">noMouse</span><span class="p">,</span> <span class="n">singleClick</span><span class="p">,</span>
                        <span class="n">acceptKeys</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">markerStart</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span>
                        <span class="n">choices</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">tickMarks</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">tickHeight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initMisc</span><span class="p">(</span><span class="n">minTime</span><span class="p">,</span> <span class="n">maxTime</span><span class="p">)</span>

        <span class="c1"># Set scale &amp; position, key-bindings:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initPosScale</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">stretch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initKeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptKeys</span><span class="p">,</span> <span class="n">skipKeys</span><span class="p">,</span>
                       <span class="n">leftKeys</span><span class="p">,</span> <span class="n">rightKeys</span><span class="p">,</span> <span class="n">respKeys</span><span class="p">)</span>

        <span class="c1"># Construct the visual elements:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initLine</span><span class="p">(</span><span class="n">tickMarkValues</span><span class="o">=</span><span class="n">tickMarks</span><span class="p">,</span>
                       <span class="n">lineColor</span><span class="o">=</span><span class="n">lineColor</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initMarker</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="n">markerColor</span><span class="p">,</span> <span class="n">markerExpansion</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initTextElements</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">textColor</span><span class="p">,</span> <span class="n">textFont</span><span class="p">,</span> <span class="n">textSize</span><span class="p">,</span>
                               <span class="n">showValue</span><span class="p">,</span> <span class="n">tickMarks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initAcceptBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showAccept</span><span class="p">,</span> <span class="n">acceptPreText</span><span class="p">,</span> <span class="n">acceptText</span><span class="p">,</span>
                            <span class="n">acceptSize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerColor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">textSizeSmall</span><span class="p">,</span>
                            <span class="n">textSize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">textFont</span><span class="p">)</span>

        <span class="c1"># List-ify the visual elements; self.marker is handled separately</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visualDisplayElements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showScale</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visualDisplayElements</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scaleDescription</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAccept</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visualDisplayElements</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptBox</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="c1"># skip any empty placeholders</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">visualDisplayElements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">marker</span> <span class="o">!=</span> <span class="s1">&#39;hover&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visualDisplayElements</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">]</span>

        <span class="c1"># Mirror (flip) vertically if requested</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flipVert</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFlipVert</span><span class="p">(</span><span class="n">flipVert</span><span class="p">)</span>

        <span class="c1"># Final touches:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origScaleDescription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaleDescription</span><span class="o">.</span><span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>  <span class="c1"># sets .status, among other things</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">setUnits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">savedWinUnits</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timedOut</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beyondMinTime</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># set autoLog (now that params have been initialised)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoLog</span> <span class="o">=</span> <span class="n">autoLog</span>
        <span class="k">if</span> <span class="n">autoLog</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="s2">&quot;Created </span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">(</span><span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>  <span class="c1"># from MinimalStim</span>

    <span class="k">def</span> <span class="nf">_initFirst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">showAccept</span><span class="p">,</span> <span class="n">mouseOnly</span><span class="p">,</span> <span class="n">noMouse</span><span class="p">,</span> <span class="n">singleClick</span><span class="p">,</span>
                   <span class="n">acceptKeys</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">markerStart</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span>
                   <span class="n">choices</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">tickMarks</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">tickHeight</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;some sanity checking; various things are set, especially those</span>
<span class="sd">        that are used later; choices, anchors, markerStart settings are</span>
<span class="sd">        handled here</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showAccept</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">showAccept</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseOnly</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">mouseOnly</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noMouse</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">noMouse</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseOnly</span>  <span class="c1"># mouseOnly wins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">singleClick</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">singleClick</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acceptKeys</span> <span class="o">=</span> <span class="n">acceptKeys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labelTexts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tickHeight</span> <span class="o">=</span> <span class="n">tickHeight</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAccept</span><span class="p">:</span>
            <span class="c1"># the accept button is the mouse-based way to accept the current</span>
            <span class="c1"># response</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptKeys</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># make sure there is in fact a way to respond using a</span>
                <span class="c1"># key-press:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">acceptKeys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;return&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseOnly</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">singleClick</span><span class="p">:</span>
                <span class="c1"># then there&#39;s no way to respond, so deny mouseOnly / enable</span>
                <span class="c1"># using keys:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mouseOnly</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;RatingScale </span><span class="si">%s</span><span class="s2">: ignoring mouseOnly (because &quot;</span>
                       <span class="s2">&quot;showAccept and singleClick are False)&quot;</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># &#39;choices&#39; is a list of non-numeric (unordered) alternatives:</span>
        <span class="k">if</span> <span class="n">choices</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">choices</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;RatingScale </span><span class="si">%s</span><span class="s2">: choices requires 2 or more items&quot;</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">choices</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">choices</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">low</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">high</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">choices</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># a fractional choice makes no sense</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labelTexts</span> <span class="o">=</span> <span class="n">choices</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">marker</span> <span class="o">==</span> <span class="s1">&#39;hover&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;RatingScale: marker=&#39;hover&#39; requires &quot;</span>
                          <span class="s2">&quot;a set of choices.&quot;</span><span class="p">)</span>
            <span class="n">core</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

        <span class="c1"># Anchors need to be well-behaved [do after choices]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">low</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">low</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">low</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">high</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="mi">100</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span>
            <span class="k">if</span> <span class="n">labels</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># label the endpoints</span>
                <span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labelTexts</span> <span class="o">=</span> <span class="p">[</span><span class="n">first</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">diff</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">last</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">labels</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">diff</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># label endpoints and middle tick</span>
                <span class="n">placeHolder</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">diff</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labelTexts</span> <span class="o">=</span> <span class="p">([</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">placeHolder</span> <span class="o">+</span>
                                   <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">placeHolder</span> <span class="o">+</span>
                                   <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
            <span class="k">elif</span> <span class="n">labels</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labelTexts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labelTexts</span> <span class="o">=</span> <span class="p">[</span><span class="n">first</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">diff</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">last</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="k">if</span> <span class="n">tickMarks</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labelTexts</span> <span class="o">=</span> <span class="n">tickMarks</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labelTexts</span> <span class="o">=</span> <span class="n">labels</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labelTexts</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tickMarks</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;RatingScale </span><span class="si">%s</span><span class="s2">: len(labels) not equal to len(tickMarks)&quot;</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labelTexts</span> <span class="o">=</span> <span class="n">tickMarks</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;&lt;default&gt;&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Marker pre-positioned? [do after anchors]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">markerStart</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">markerStart</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">and</span>
                    <span class="n">markerStart</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">markerStart</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">markerPlaced</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">markerPlaced</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># float(markerStart) succeeded</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerPlaced</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># default markerStart = 0 if needed but otherwise unspecified:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noMouse</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerPlaced</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_initMisc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minTime</span><span class="p">,</span> <span class="n">maxTime</span><span class="p">):</span>
        <span class="c1"># precision is the fractional parts of a tick mark to be sensitive to,</span>
        <span class="c1"># in [1,10,100]:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fmtStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">&quot;</span>  <span class="c1"># decimal places, purely for display</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">==</span> <span class="mi">60</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fmtStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span>  <span class="c1"># minutes:seconds.zfill(2)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fmtStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.1f</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fmtStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>  <span class="c1"># for decision time</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minTime</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">minTime</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minTime</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minTime</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minTime</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maxTime</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">maxTime</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maxTime</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowTimeOut</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minTime</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxTime</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myMouse</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">Mouse</span><span class="p">(</span>
            <span class="n">win</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">noMouse</span><span class="p">))</span>
        <span class="c1"># Mouse-click-able &#39;accept&#39; button pulsates (cycles its brightness</span>
        <span class="c1"># over frames):</span>
        <span class="n">framesPerCycle</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pulseColor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.6</span> <span class="o">+</span> <span class="mf">0.22</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mf">15.65</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">framesPerCycle</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">_initPosScale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">stretch</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;position (x,y) and size (magnification) of the rating scale</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Screen position (translation) of the rating scale as a whole:</span>
        <span class="k">if</span> <span class="n">pos</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">offsetHoriz</span><span class="p">,</span> <span class="n">offsetVert</span> <span class="o">=</span> <span class="n">pos</span>
            <span class="k">elif</span> <span class="n">log</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoLog</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;RatingScale </span><span class="si">%s</span><span class="s2">: pos expects a tuple (x,y)&quot;</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">offsetHoriz</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savedWinUnits</span> <span class="o">==</span> <span class="s1">&#39;pix&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># default x in norm units:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">offsetVert</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savedWinUnits</span> <span class="o">==</span> <span class="s1">&#39;pix&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/-</span><span class="mf">5.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># default y in norm units:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.4</span>
        <span class="c1"># pos=(x,y) will consider x,y to be in win units, but want norm</span>
        <span class="c1"># internally</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">savedWinUnits</span> <span class="o">==</span> <span class="s1">&#39;pix&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">0.5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">0.5</span>
        <span class="c1"># just expose; not used elsewhere yet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span><span class="p">]</span>

        <span class="c1"># Scale size (magnification) of the rating scale as a whole:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stretch</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">stretch</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stretch</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.6</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mf">0.6</span>

    <span class="k">def</span> <span class="nf">_initKeys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acceptKeys</span><span class="p">,</span> <span class="n">skipKeys</span><span class="p">,</span> <span class="n">leftKeys</span><span class="p">,</span> <span class="n">rightKeys</span><span class="p">,</span> <span class="n">respKeys</span><span class="p">):</span>
        <span class="c1"># keys for accepting the currently selected response:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseOnly</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acceptKeys</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># no valid keys, so must use mouse</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">acceptKeys</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">]:</span>
                <span class="n">acceptKeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">acceptKeys</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acceptKeys</span> <span class="o">=</span> <span class="n">acceptKeys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skipKeys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">skipKeys</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseOnly</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">skipKeys</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">]:</span>
                <span class="n">skipKeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">skipKeys</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">skipKeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">skipKeys</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">leftKeys</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">]:</span>
            <span class="n">leftKeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">leftKeys</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">leftKeys</span> <span class="o">=</span> <span class="n">leftKeys</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rightKeys</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">]:</span>
            <span class="n">rightKeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">rightKeys</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rightKeys</span> <span class="o">=</span> <span class="n">rightKeys</span>

        <span class="c1"># allow responding via arbitrary keys if given as a param:</span>
        <span class="n">nonRespKeys</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leftKeys</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rightKeys</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptKeys</span> <span class="o">+</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">skipKeys</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">respKeys</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">respKeys</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">respKeys</span> <span class="o">=</span> <span class="n">respKeys</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enableRespKeys</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">respKeys</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">nonRespKeys</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;RatingScale </span><span class="si">%s</span><span class="s1">: respKeys may conflict with other keys&#39;</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># allow resp via numeric keys if the response range is in 0-9</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">respKeys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseOnly</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">respKeys</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="c1"># but if any digit is used as an action key, that should</span>
            <span class="c1"># take precedence so disable using numeric keys:</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">respKeys</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">nonRespKeys</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">([]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enableRespKeys</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enableRespKeys</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableRespKeys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tickFromKeyPress</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">respKeys</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tickFromKeyPress</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span>

        <span class="c1"># if self.noMouse:</span>
        <span class="c1">#     could check that there are appropriate response keys</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">allKeys</span> <span class="o">=</span> <span class="n">nonRespKeys</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">respKeys</span>

    <span class="k">def</span> <span class="nf">_initLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tickMarkValues</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lineColor</span><span class="o">=</span><span class="s1">&#39;White&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;define a ShapeStim to be a graphical line, with tick marks.</span>

<span class="sd">        ### Notes (JRG Aug 2010)</span>
<span class="sd">        Conceptually, the response line is always -0.5 to +0.5</span>
<span class="sd">        (&quot;internal&quot; units). This line, of unit length, is scaled and</span>
<span class="sd">        translated for display. The line is effectively &quot;center justified&quot;,</span>
<span class="sd">        expanding both left and right with scaling, with pos[] specifying</span>
<span class="sd">        the screen coordinate (in window units, norm or pix) of the</span>
<span class="sd">        mid-point of the response line. Tick marks are in integer units,</span>
<span class="sd">        internally 0 to (high-low), with 0 being the left end and (high-low)</span>
<span class="sd">        being the right end. (Subjects see low to high on the screen.)</span>
<span class="sd">        Non-numeric (categorical) choices are selected using tick-marks</span>
<span class="sd">        interpreted as an index, choice[tick]. Tick units get mapped to</span>
<span class="sd">        &quot;internal&quot; units based on their proportion of the total ticks</span>
<span class="sd">        (--&gt; 0. to 1.). The unit-length internal line is expanded or</span>
<span class="sd">        contracted by stretch and size, and then is translated to</span>
<span class="sd">        position pos (offsetHoriz=pos[0], offsetVert=pos[1]).</span>
<span class="sd">        pos is the name of the arg, and its values appear in the code as</span>
<span class="sd">        offsetHoriz and offsetVert only for historical reasons (could be</span>
<span class="sd">        refactored for clarity).</span>

<span class="sd">        Auto-rescaling reduces the number of tick marks shown on the</span>
<span class="sd">        screen by a factor of 10, just for nicer appearance, without</span>
<span class="sd">        affecting the internal representation.</span>

<span class="sd">        Thus, the horizontal screen position of the i-th tick mark,</span>
<span class="sd">        where i in [0,n], for n total ticks (n = high-low),</span>
<span class="sd">        in screen units (&#39;norm&#39;) will be:</span>
<span class="sd">          tick-i             == offsetHoriz + (-0.5 + i/n ) * stretch * size</span>
<span class="sd">        So two special cases are:</span>
<span class="sd">          tick-0 (left end)  == offsetHoriz - 0.5 * stretch * size</span>
<span class="sd">          tick-n (right end) == offsetHoriz + 0.5 * stretch * size</span>
<span class="sd">        The vertical screen position is just offsetVert (in screen norm units).</span>
<span class="sd">        To elaborate: tick-0 is the left-most tick, or &quot;low anchor&quot;;</span>
<span class="sd">        here 0 is internal, the subject sees &lt;low&gt;.</span>
<span class="sd">        tick-n is the right-most tick, or &quot;high anchor&quot;, or</span>
<span class="sd">        internal-tick-(high-low), and the subject sees &lt;high&gt;.</span>
<span class="sd">        Intermediate ticks, i, are located proportionally</span>
<span class="sd">        between -0.5 to + 0.5, based on their proportion</span>
<span class="sd">        of the total number of ticks, float(i)/n.</span>
<span class="sd">        The &quot;proportion of total&quot; is used because it&#39;s a line of unit length,</span>
<span class="sd">        i.e., the same length as used to internally represent the</span>
<span class="sd">        scale (-0.5 to +0.5).</span>
<span class="sd">        If precision &gt; 1, the user / experimenter is asking for</span>
<span class="sd">        fractional ticks. These map correctly</span>
<span class="sd">        onto [0, 1] as well without requiring special handling</span>
<span class="sd">        (just do ensure float() ).</span>

<span class="sd">        Another note: -0.5 to +0.5 looked too big to be the default</span>
<span class="sd">        size of the rating line in screen norm units,</span>
<span class="sd">        so I set the internal size = 0.6 to compensate (i.e., making</span>
<span class="sd">        everything smaller). The user can adjust the scaling around</span>
<span class="sd">        the default by setting size, stretch, or both.</span>
<span class="sd">        This means that the user / experimenter can just think of &gt; 1</span>
<span class="sd">        being expansion (and &lt; 1 == contraction) relative to the default</span>
<span class="sd">        (internal) scaling, and not worry about the internal scaling.</span>

<span class="sd">        ### Notes (HS November 2012)</span>
<span class="sd">        To allow for labels at the ticks, the positions of the tick marks</span>
<span class="sd">        are saved in self.tickPositions. If tickMarks, those positions</span>
<span class="sd">        are used instead of the automatic positions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lineColor</span> <span class="o">=</span> <span class="n">lineColor</span>
        <span class="c1"># vertical height of each tick, norm units; used for markers too:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseSize</span> <span class="o">=</span> <span class="mf">0.04</span>
        <span class="c1"># num tick marks to display, can get autorescaled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tickMarks</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoRescaleFactor</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">tickMarkValues</span><span class="p">:</span>
            <span class="n">tickTmp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tickMarkValues</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="n">tickMarkPositions</span> <span class="o">=</span> <span class="p">(</span><span class="n">tickTmp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">tickMarks</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># visually remap 10 ticks onto 1 tick in some conditions (=</span>
            <span class="c1"># cosmetic):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">low</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tickMarks</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="ow">and</span>
                    <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tickMarks</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">autoRescaleFactor</span> <span class="o">=</span> <span class="mi">10</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tickMarks</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoRescaleFactor</span>
            <span class="n">tickMarkPositions</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tickMarks</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaledPrecision</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoRescaleFactor</span><span class="p">)</span>

        <span class="c1"># how far a left or right key will move the marker, in tick units:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyIncrement</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoRescaleFactor</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hStretchTotal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stretch</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>

        <span class="c1"># ends of the rating line, in norm units:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineLeftEnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hStretchTotal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineRightEnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hStretchTotal</span>

        <span class="c1"># space around the line within which to accept mouse input:</span>
        <span class="c1"># not needed if self.noMouse, but not a problem either</span>
        <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.06</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">marker</span> <span class="o">==</span> <span class="s1">&#39;hover&#39;</span><span class="p">:</span>
            <span class="n">padText</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">)))</span> <span class="o">*</span>
                       <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineRightEnd</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineLeftEnd</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">padText</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nearLine</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lineLeftEnd</span> <span class="o">-</span> <span class="n">pad</span> <span class="o">-</span> <span class="n">padText</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pad</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lineLeftEnd</span> <span class="o">-</span> <span class="n">pad</span> <span class="o">-</span> <span class="n">padText</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pad</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lineRightEnd</span> <span class="o">+</span> <span class="n">pad</span> <span class="o">+</span> <span class="n">padText</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pad</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span><span class="p">],</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lineRightEnd</span> <span class="o">+</span> <span class="n">pad</span> <span class="o">+</span> <span class="n">padText</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pad</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span><span class="p">]]</span>

        <span class="c1"># vertices for ShapeStim:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tickPositions</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list to hold horizontal positions</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">lineLeftEnd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span><span class="p">]]</span>  <span class="c1"># first vertex</span>
        <span class="c1"># vertical height of ticks (purely cosmetic):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tickHeight</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tickHeight</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span>  <span class="c1"># backwards compatibility for boolean</span>
        <span class="c1"># numeric -&gt; scale tick height;  float(True) == 1.</span>
        <span class="n">tickSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseSize</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tickHeight</span><span class="p">)</span>
        <span class="n">lineLength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineRightEnd</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineLeftEnd</span>
        <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">tick</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tickMarkPositions</span><span class="p">):</span>
            <span class="n">horizTmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineLeftEnd</span> <span class="o">+</span> <span class="n">lineLength</span> <span class="o">*</span> <span class="n">tick</span>
            <span class="n">vertices</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">horizTmp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span> <span class="o">+</span> <span class="n">tickSize</span><span class="p">],</span>
                         <span class="p">[</span><span class="n">horizTmp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tickMarkPositions</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">tickRelPos</span> <span class="o">=</span> <span class="n">lineLength</span> <span class="o">*</span> <span class="n">tickMarkPositions</span><span class="p">[</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">nextHorizTmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineLeftEnd</span> <span class="o">+</span> <span class="n">tickRelPos</span>
                <span class="n">vertices</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">nextHorizTmp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tickPositions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">horizTmp</span><span class="p">)</span>
        <span class="n">vertices</span> <span class="o">+=</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">lineRightEnd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span><span class="p">],</span>
                     <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lineLeftEnd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span><span class="p">]]</span>

        <span class="c1"># create the line:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">ShapeStim</span><span class="p">(</span><span class="n">win</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="n">vertices</span><span class="o">=</span><span class="n">vertices</span><span class="p">,</span>
                              <span class="n">lineWidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">lineColor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineColor</span><span class="p">,</span>
                              <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.line&#39;</span><span class="p">,</span> <span class="n">autoLog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_initMarker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">markerColor</span><span class="p">,</span> <span class="n">expansion</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;define a visual Stim to be used as the indicator.</span>

<span class="sd">        marker can be either a string, or a visual object (custom marker).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># preparatory stuff:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markerOffsetVert</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerStyle</span> <span class="o">=</span> <span class="n">marker</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="s1">&#39;draw&#39;</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;RatingScale: custom marker has no draw() method&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerStyle</span> <span class="o">=</span> <span class="s1">&#39;triangle&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerStyle</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">markerOffsetVert</span> <span class="o">=</span> <span class="n">marker</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;RatingScale: custom marker has no pos attribute&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">markerSize</span> <span class="o">=</span> <span class="mf">8.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markerColor</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">markerColor</span> <span class="o">=</span> <span class="n">markerColor</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># define or create self.marker:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStyle</span> <span class="o">==</span> <span class="s1">&#39;hover&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker</span> <span class="o">=</span> <span class="n">TextStim</span><span class="p">(</span><span class="n">win</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span>
                                   <span class="n">autoLog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># placeholder</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerOffsetVert</span> <span class="o">=</span> <span class="mf">.02</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">markerColor</span><span class="p">:</span>
                <span class="n">markerColor</span> <span class="o">=</span> <span class="s1">&#39;darkorange&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStyle</span> <span class="o">==</span> <span class="s1">&#39;triangle&#39;</span><span class="p">:</span>
            <span class="n">scaledTickSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseSize</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
            <span class="n">vert</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">scaledTickSize</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">,</span> <span class="n">scaledTickSize</span> <span class="o">*</span> <span class="mi">3</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">scaledTickSize</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">,</span> <span class="n">scaledTickSize</span> <span class="o">*</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.005</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">markerColor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">markerColor</span> <span class="o">=</span> <span class="s1">&#39;DarkBlue&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker</span> <span class="o">=</span> <span class="n">ShapeStim</span><span class="p">(</span><span class="n">win</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="n">vertices</span><span class="o">=</span><span class="n">vert</span><span class="p">,</span>
                                    <span class="n">lineWidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">lineColor</span><span class="o">=</span><span class="n">markerColor</span><span class="p">,</span>
                                    <span class="n">fillColor</span><span class="o">=</span><span class="n">markerColor</span><span class="p">,</span>
                                    <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.markerTri&#39;</span><span class="p">,</span>
                                    <span class="n">autoLog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStyle</span> <span class="o">==</span> <span class="s1">&#39;slider&#39;</span><span class="p">:</span>
            <span class="n">scaledTickSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseSize</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
            <span class="n">vert</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">scaledTickSize</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">,</span> <span class="n">scaledTickSize</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">scaledTickSize</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">,</span> <span class="n">scaledTickSize</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">scaledTickSize</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">scaledTickSize</span><span class="p">],</span>
                    <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">scaledTickSize</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">scaledTickSize</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">markerColor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">markerColor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker</span> <span class="o">=</span> <span class="n">ShapeStim</span><span class="p">(</span><span class="n">win</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="n">vertices</span><span class="o">=</span><span class="n">vert</span><span class="p">,</span>
                                    <span class="n">lineWidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">lineColor</span><span class="o">=</span><span class="n">markerColor</span><span class="p">,</span>
                                    <span class="n">fillColor</span><span class="o">=</span><span class="n">markerColor</span><span class="p">,</span>
                                    <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.markerSlider&#39;</span><span class="p">,</span>
                                    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">autoLog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStyle</span> <span class="o">==</span> <span class="s1">&#39;glow&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">markerColor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">markerColor</span> <span class="o">=</span> <span class="s1">&#39;White&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker</span> <span class="o">=</span> <span class="n">PatchStim</span><span class="p">(</span><span class="n">win</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span>
                                    <span class="n">tex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="s1">&#39;gauss&#39;</span><span class="p">,</span>
                                    <span class="n">color</span><span class="o">=</span><span class="n">markerColor</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span>
                                    <span class="n">autoLog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.markerGlow&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerBaseSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseSize</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerSize</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerOffsetVert</span> <span class="o">=</span> <span class="mf">.02</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerExpansion</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.6</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerExpansion</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">markerBaseSize</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerSize</span> <span class="o">*</span> <span class="mf">0.7</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerSize</span> <span class="o">&gt;</span> <span class="mf">1.2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">markerBaseSize</span> <span class="o">*=</span> <span class="mf">.7</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">setSize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markerBaseSize</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStyle</span> <span class="o">==</span> <span class="s1">&#39;custom&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">markerColor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># marker.color 0 causes problems elsewhere too</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">marker</span><span class="o">.</span><span class="n">color</span><span class="p">:</span>
                            <span class="n">marker</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;DarkBlue&#39;</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># testing truth value of list</span>
                        <span class="n">marker</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;DarkBlue&#39;</span>
                <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="s1">&#39;fillColor&#39;</span><span class="p">):</span>
                    <span class="n">marker</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">marker</span><span class="o">.</span><span class="n">fillColor</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">marker</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;DarkBlue&#39;</span>
                <span class="n">markerColor</span> <span class="o">=</span> <span class="n">marker</span><span class="o">.</span><span class="n">color</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">marker</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">marker</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;customMarker&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker</span> <span class="o">=</span> <span class="n">marker</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># &#39;circle&#39;:</span>
            <span class="k">if</span> <span class="n">markerColor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">markerColor</span> <span class="o">=</span> <span class="s1">&#39;DarkRed&#39;</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">size</span>
            <span class="n">windowRatio</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerSizeVert</span> <span class="o">=</span> <span class="mf">3.2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseSize</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
            <span class="n">circleSize</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">markerSizeVert</span> <span class="o">*</span>
                          <span class="n">windowRatio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerSizeVert</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerOffsetVert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerSizeVert</span><span class="o">/</span><span class="mf">2.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">circleSize</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span>
                                 <span class="n">lineColor</span><span class="o">=</span><span class="n">markerColor</span><span class="p">,</span> <span class="n">fillColor</span><span class="o">=</span><span class="n">markerColor</span><span class="p">,</span>
                                 <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.markerCir&#39;</span><span class="p">,</span> <span class="n">autoLog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerBaseSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markerColor</span> <span class="o">=</span> <span class="n">markerColor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markerYpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerOffsetVert</span>
        <span class="c1"># save initial state, restore on reset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markerColorOriginal</span> <span class="o">=</span> <span class="n">markerColor</span>

    <span class="k">def</span> <span class="nf">_initTextElements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">win</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">textColor</span><span class="p">,</span>
                          <span class="n">textFont</span><span class="p">,</span> <span class="n">textSize</span><span class="p">,</span> <span class="n">showValue</span><span class="p">,</span> <span class="n">tickMarks</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;creates TextStim for self.scaleDescription and self.labels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># text appearance (size, color, font, visibility):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showValue</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">showValue</span><span class="p">)</span>  <span class="c1"># hide if False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textColor</span> <span class="o">=</span> <span class="n">textColor</span>  <span class="c1"># rgb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textFont</span> <span class="o">=</span> <span class="n">textFont</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textSize</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">textSize</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textSizeSmall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textSize</span> <span class="o">*</span> <span class="mf">0.6</span>

        <span class="c1"># set the description text if not already set by user:</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;&lt;default&gt;&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39; = not at all . . . extremely = &#39;</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">)</span> <span class="o">+</span> <span class="n">msg</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>

        <span class="c1"># create the TextStim:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaleDescription</span> <span class="o">=</span> <span class="n">TextStim</span><span class="p">(</span>
            <span class="n">win</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">textSizeSmall</span><span class="p">,</span>
            <span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span><span class="p">,</span> <span class="mf">0.22</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">textColor</span><span class="p">,</span> <span class="n">wrapWidth</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hStretchTotal</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="n">textFont</span><span class="p">,</span> <span class="n">autoLog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaleDescription</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">textFont</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelTexts</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStyle</span> <span class="o">==</span> <span class="s1">&#39;hover&#39;</span><span class="p">:</span>
                <span class="n">vertPosTmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span>  <span class="c1"># on the line = clickable labels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vertPosTmp</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">textSizeSmall</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labelTexts</span><span class="p">):</span>
                <span class="c1"># need all labels for tick position, i</span>
                <span class="k">if</span> <span class="n">label</span> <span class="ow">or</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># &#39;is not None&#39; allows creation of &#39;0&#39; (zero or false) labels</span>
                    <span class="n">txtStim</span> <span class="o">=</span> <span class="n">TextStim</span><span class="p">(</span>
                        <span class="n">win</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">),</span> <span class="n">font</span><span class="o">=</span><span class="n">textFont</span><span class="p">,</span>
                        <span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tickPositions</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoRescaleFactor</span><span class="p">],</span>
                             <span class="n">vertPosTmp</span><span class="p">],</span>
                        <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">textSizeSmall</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">textColor</span><span class="p">,</span>
                        <span class="n">autoLog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txtStim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origScaleDescription</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>  <span class="c1"># do last</span>

    <span class="k">def</span> <span class="nf">_setMarkerColor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the fill color or color of the marker&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">setFillColor</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">colorSpace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorSpace</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">colorSpace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorSpace</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

<div class="viewcode-block" id="RatingScale.setDescription">
<a class="viewcode-back" href="../../../../coder/RatingScale/#psychopy_legacy.visual.ratingscale.RatingScale.setDescription">[docs]</a>
    <span class="k">def</span> <span class="nf">setDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to set the brief description (scale).</span>

<span class="sd">        Useful when using the same RatingScale object to rate several</span>
<span class="sd">        dimensions. `setDescription(None)` will reset the description</span>
<span class="sd">        to its initial state. Set to a space character (&#39; &#39;) to make</span>
<span class="sd">        the description invisible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origScaleDescription</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaleDescription</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showScale</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>  <span class="c1"># not in [None, False, &#39;&#39;]</span>
        <span class="k">if</span> <span class="n">log</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoLog</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="s1">&#39;RatingScale </span><span class="si">%s</span><span class="s1">: setDescription=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaleDescription</span><span class="o">.</span><span class="n">text</span><span class="p">))</span></div>


    <span class="k">def</span> <span class="nf">_initAcceptBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">showAccept</span><span class="p">,</span> <span class="n">acceptPreText</span><span class="p">,</span> <span class="n">acceptText</span><span class="p">,</span>
                       <span class="n">acceptSize</span><span class="p">,</span> <span class="n">markerColor</span><span class="p">,</span>
                       <span class="n">textSizeSmall</span><span class="p">,</span> <span class="n">textSize</span><span class="p">,</span> <span class="n">textFont</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;creates a ShapeStim for self.acceptBox (mouse-click-able</span>
<span class="sd">        &#39;accept&#39;  button) and a TextStim for self.accept (container for</span>
<span class="sd">        the text shown inside the box)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">showAccept</span><span class="p">:</span>  <span class="c1"># no point creating things that won&#39;t be used</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">acceptLineColor</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">.2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acceptFillColor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.2</span><span class="p">,</span> <span class="mf">.2</span><span class="p">,</span> <span class="mf">.2</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelTexts</span><span class="p">:</span>
            <span class="n">boxVert</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.47</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boxVert</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">]</span>

        <span class="c1"># define self.acceptBox:</span>
        <span class="n">sizeFactor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="n">textSize</span>
        <span class="n">leftRightAdjust</span> <span class="o">=</span> <span class="mf">0.04</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">acceptSize</span><span class="p">)</span> <span class="o">*</span> <span class="n">sizeFactor</span>
        <span class="n">acceptBoxtop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span> <span class="o">-</span> <span class="n">boxVert</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">sizeFactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acceptBoxtop</span> <span class="o">=</span> <span class="n">acceptBoxtop</span>
        <span class="n">acceptBoxbot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span> <span class="o">-</span> <span class="n">boxVert</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sizeFactor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acceptBoxbot</span> <span class="o">=</span> <span class="n">acceptBoxbot</span>
        <span class="n">acceptBoxleft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span> <span class="o">-</span> <span class="n">leftRightAdjust</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acceptBoxleft</span> <span class="o">=</span> <span class="n">acceptBoxleft</span>
        <span class="n">acceptBoxright</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span> <span class="o">+</span> <span class="n">leftRightAdjust</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acceptBoxright</span> <span class="o">=</span> <span class="n">acceptBoxright</span>

        <span class="c1"># define a rectangle with rounded corners; for square corners, set</span>
        <span class="c1"># delta2 to 0</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mf">0.025</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
        <span class="n">delta2</span> <span class="o">=</span> <span class="n">delta</span><span class="o">/</span><span class="mi">7</span>
        <span class="n">acceptBoxVertices</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">acceptBoxleft</span><span class="p">,</span> <span class="n">acceptBoxtop</span> <span class="o">-</span> <span class="n">delta</span><span class="p">],</span>
            <span class="p">[</span><span class="n">acceptBoxleft</span> <span class="o">+</span> <span class="n">delta2</span><span class="p">,</span> <span class="n">acceptBoxtop</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">delta2</span><span class="p">],</span>
            <span class="p">[</span><span class="n">acceptBoxleft</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">delta2</span><span class="p">,</span> <span class="n">acceptBoxtop</span> <span class="o">-</span> <span class="n">delta2</span><span class="p">],</span>
            <span class="p">[</span><span class="n">acceptBoxleft</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">acceptBoxtop</span><span class="p">],</span>
            <span class="p">[</span><span class="n">acceptBoxright</span> <span class="o">-</span> <span class="n">delta</span><span class="p">,</span> <span class="n">acceptBoxtop</span><span class="p">],</span>
            <span class="p">[</span><span class="n">acceptBoxright</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">delta2</span><span class="p">,</span> <span class="n">acceptBoxtop</span> <span class="o">-</span> <span class="n">delta2</span><span class="p">],</span>
            <span class="p">[</span><span class="n">acceptBoxright</span> <span class="o">-</span> <span class="n">delta2</span><span class="p">,</span> <span class="n">acceptBoxtop</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">delta2</span><span class="p">],</span>
            <span class="p">[</span><span class="n">acceptBoxright</span><span class="p">,</span> <span class="n">acceptBoxtop</span> <span class="o">-</span> <span class="n">delta</span><span class="p">],</span>
            <span class="p">[</span><span class="n">acceptBoxright</span><span class="p">,</span> <span class="n">acceptBoxbot</span> <span class="o">+</span> <span class="n">delta</span><span class="p">],</span>
            <span class="p">[</span><span class="n">acceptBoxright</span> <span class="o">-</span> <span class="n">delta2</span><span class="p">,</span> <span class="n">acceptBoxbot</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">delta2</span><span class="p">],</span>
            <span class="p">[</span><span class="n">acceptBoxright</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">delta2</span><span class="p">,</span> <span class="n">acceptBoxbot</span> <span class="o">+</span> <span class="n">delta2</span><span class="p">],</span>
            <span class="p">[</span><span class="n">acceptBoxright</span> <span class="o">-</span> <span class="n">delta</span><span class="p">,</span> <span class="n">acceptBoxbot</span><span class="p">],</span>
            <span class="p">[</span><span class="n">acceptBoxleft</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">acceptBoxbot</span><span class="p">],</span>
            <span class="p">[</span><span class="n">acceptBoxleft</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">delta2</span><span class="p">,</span> <span class="n">acceptBoxbot</span> <span class="o">+</span> <span class="n">delta2</span><span class="p">],</span>
            <span class="p">[</span><span class="n">acceptBoxleft</span> <span class="o">+</span> <span class="n">delta2</span><span class="p">,</span> <span class="n">acceptBoxbot</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">delta2</span><span class="p">],</span>
            <span class="p">[</span><span class="n">acceptBoxleft</span><span class="p">,</span> <span class="n">acceptBoxbot</span> <span class="o">+</span> <span class="n">delta</span><span class="p">]]</span>
        <span class="c1"># interpolation looks bad on linux, as of Aug 2010</span>
        <span class="n">interpolate</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;linux&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acceptBox</span> <span class="o">=</span> <span class="n">ShapeStim</span><span class="p">(</span>
            <span class="n">win</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span> <span class="n">vertices</span><span class="o">=</span><span class="n">acceptBoxVertices</span><span class="p">,</span>
            <span class="n">fillColor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptFillColor</span><span class="p">,</span> <span class="n">lineColor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptLineColor</span><span class="p">,</span>
            <span class="n">interpolate</span><span class="o">=</span><span class="n">interpolate</span><span class="p">,</span> <span class="n">autoLog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># text to display inside accept button before a marker is placed:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseOnly</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keyClick</span> <span class="o">=</span> <span class="s1">&#39;key, click&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keyClick</span> <span class="o">=</span> <span class="s1">&#39;click line&#39;</span>
        <span class="k">if</span> <span class="n">acceptPreText</span> <span class="o">!=</span> <span class="s1">&#39;key, click&#39;</span><span class="p">:</span>  <span class="c1"># non-default</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keyClick</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">acceptPreText</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acceptText</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">acceptText</span><span class="p">)</span>

        <span class="c1"># create the TextStim:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept</span> <span class="o">=</span> <span class="n">TextStim</span><span class="p">(</span>
            <span class="n">win</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">keyClick</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">textFont</span><span class="p">,</span>
            <span class="n">pos</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span><span class="p">,</span> <span class="p">(</span><span class="n">acceptBoxtop</span> <span class="o">+</span> <span class="n">acceptBoxbot</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">],</span>
            <span class="n">italic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">textSizeSmall</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">textColor</span><span class="p">,</span>
            <span class="n">autoLog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">textFont</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">acceptTextColor</span> <span class="o">=</span> <span class="n">markerColor</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markerColor</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># warning raised if color not specified as a string</span>
            <span class="k">if</span> <span class="n">markerColor</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;White&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">acceptTextColor</span> <span class="o">=</span> <span class="s1">&#39;Black&#39;</span>

    <span class="k">def</span> <span class="nf">_getMarkerFromPos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouseX</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert mouseX into units of tick marks, 0 .. high-low.</span>

<span class="sd">        Will be fractional if precision &gt; 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">mouseX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineLeftEnd</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineRightEnd</span><span class="p">)</span>
        <span class="c1"># map mouseX==0 -&gt; mid-point of tick scale:</span>
        <span class="n">_tickStretch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tickMarks</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">hStretchTotal</span>
        <span class="n">adjValue</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span>
        <span class="n">markerPos</span> <span class="o">=</span> <span class="n">adjValue</span> <span class="o">*</span> <span class="n">_tickStretch</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tickMarks</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="c1"># We need float value in getRating(), but round() returns</span>
        <span class="c1"># numpy.float64 if argument is numpy.float64 in Python3.</span>
        <span class="c1"># So we have to convert return value of round() to float.</span>
        <span class="n">rounded</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">markerPos</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaledPrecision</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">rounded</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scaledPrecision</span>

    <span class="k">def</span> <span class="nf">_getMarkerFromTick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tick</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a requested tick value into a position on internal scale.</span>

<span class="sd">        Accounts for non-zero low end, autoRescale, and precision.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ensure its on the line:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">high</span><span class="p">,</span> <span class="n">tick</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">)</span>
        <span class="c1"># set requested precision:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaledPrecision</span><span class="p">)</span><span class="o">//</span><span class="bp">self</span><span class="o">.</span><span class="n">scaledPrecision</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoRescaleFactor</span>

<div class="viewcode-block" id="RatingScale.setMarkerPos">
<a class="viewcode-back" href="../../../../coder/RatingScale/#psychopy_legacy.visual.ratingscale.RatingScale.setMarkerPos">[docs]</a>
    <span class="k">def</span> <span class="nf">setMarkerPos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tick</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to allow the experimenter to set the marker&#39;s position</span>
<span class="sd">        on the scale (in units of tick marks). This method can also set</span>
<span class="sd">        the index within a list of choices (which start at 0).</span>
<span class="sd">        No range checking is done.</span>

<span class="sd">        Assuming you have defined rs = RatingScale(...), you can specify</span>
<span class="sd">        a tick position directly::</span>

<span class="sd">            rs.setMarkerPos(2)</span>

<span class="sd">        or do range checking, precision management, and auto-rescaling::</span>

<span class="sd">            rs.setMarkerPos(rs._getMarkerFromTick(2))</span>

<span class="sd">        To work from a screen coordinate, such as the X position of a</span>
<span class="sd">        mouse click::</span>

<span class="sd">            rs.setMarkerPos(rs._getMarkerFromPos(mouseX))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">=</span> <span class="n">tick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markerPlaced</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># only needed first time</span></div>


<div class="viewcode-block" id="RatingScale.setFlipVert">
<a class="viewcode-back" href="../../../../coder/RatingScale/#psychopy_legacy.visual.ratingscale.RatingScale.setFlipVert">[docs]</a>
    <span class="k">def</span> <span class="nf">setFlipVert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newVal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets current vertical mirroring to ``newVal``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flipVert</span> <span class="o">!=</span> <span class="n">newVal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flipVert</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">flipVert</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerYpos</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">groupFlipVert</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nearLine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="p">]</span> <span class="o">+</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">visualDisplayElements</span><span class="p">)</span>
        <span class="n">logAttrib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="s1">&#39;flipVert&#39;</span><span class="p">)</span></div>


    <span class="c1"># autoDraw and setAutoDraw are inherited from basevisual.MinimalStim</span>

<div class="viewcode-block" id="RatingScale.acceptResponse">
<a class="viewcode-back" href="../../../../coder/RatingScale/#psychopy_legacy.visual.ratingscale.RatingScale.acceptResponse">[docs]</a>
    <span class="k">def</span> <span class="nf">acceptResponse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">triggeringAction</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Commit and optionally log a response and the action.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noResponse</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">getRating</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRT</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">log</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoLog</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">triggeringAction</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getRating</span><span class="p">()))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;RatingScale </span><span class="si">%s</span><span class="s1">: (</span><span class="si">%s</span><span class="s1">) rating=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">vals</span><span class="p">)</span></div>


<div class="viewcode-block" id="RatingScale.setYPos">
<a class="viewcode-back" href="../../../../coder/RatingScale/#psychopy_legacy.visual.ratingscale.RatingScale.setYPos">[docs]</a>
    <span class="k">def</span> <span class="nf">setYPos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newPos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function can be called by the user to change the Y-positioning of the rating scale.</span>
<span class="sd">        X location remains unchanged.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">oldXPos</span><span class="p">,</span> <span class="n">oldYPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">newPos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">newPos</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">offsetHoriz</span><span class="p">,</span> <span class="n">offsetVert</span> <span class="o">=</span> <span class="n">newPos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">offsetHoriz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">offsetVert</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">positions</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualDisplayElements</span><span class="p">:</span> <span class="c1"># change location of elements based on position arg</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">positions</span><span class="o">.</span><span class="n">pos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;ShapeStim&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">positions</span><span class="p">)):</span>
                    <span class="n">offsetY</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">oldYPos</span> <span class="o">-</span> <span class="n">positions</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">positions</span><span class="o">.</span><span class="n">setPos</span><span class="p">([</span><span class="n">positions</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span> <span class="o">+</span> <span class="n">offsetY</span><span class="p">])</span>
                    <span class="k">if</span> <span class="s1">&#39;.line&#39;</span> <span class="ow">in</span> <span class="n">positions</span><span class="o">.</span><span class="n">name</span><span class="p">:</span><span class="c1"># then change Y location of marker and mouse click box</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">markerYpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nearLine</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">nearLine</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">offsetVert</span><span class="o">-</span><span class="mf">.072</span><span class="p">,</span> <span class="n">offsetVert</span><span class="o">-</span><span class="mf">.072</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nearLine</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nearLine</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">offsetVert</span> <span class="o">+</span><span class="mf">.072</span><span class="p">,</span> <span class="n">offsetVert</span> <span class="o">+</span> <span class="mf">.072</span>
                <span class="k">if</span> <span class="s1">&#39;TextStim&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">positions</span><span class="p">)):</span>
                    <span class="n">offsetY</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">oldYPos</span><span class="o">-</span><span class="n">positions</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">positions</span><span class="o">.</span><span class="n">setPos</span><span class="p">([</span><span class="n">positions</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span> <span class="o">-</span> <span class="n">offsetY</span><span class="p">])</span></div>



<div class="viewcode-block" id="RatingScale.draw">
<a class="viewcode-back" href="../../../../coder/RatingScale/#psychopy_legacy.visual.ratingscale.RatingScale.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the visual display, check for response (key, mouse, skip).</span>

<span class="sd">        Sets response flags: `self.noResponse`, `self.timedOut`.</span>
<span class="sd">        `draw()` only draws the rating scale, not the item to be rated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">setUnits</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># get restored</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstDraw</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">firstDraw</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">STARTED</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span><span class="p">:</span>
                <span class="c1"># has been converted in index if given as str</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span> <span class="o">%</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="ow">or</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># back to str for history</span>
                    <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="p">[(</span><span class="n">first</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)]</span>  <span class="c1"># this will grow</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beyondMinTime</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># has minTime elapsed?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timedOut</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">beyondMinTime</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beyondMinTime</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">minTime</span><span class="p">)</span>
        <span class="c1"># beyond maxTime = timed out? max &lt; min means never allow time-out</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allowTimeOut</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">timedOut</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">maxTime</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">()):</span>
            <span class="c1"># only do this stuff once</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timedOut</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acceptResponse</span><span class="p">(</span><span class="s1">&#39;timed out: </span><span class="si">%.3f</span><span class="s1">s&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxTime</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>

        <span class="c1"># &#39;disappear&#39; == draw nothing if subj is done:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noResponse</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">disappear</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">setUnits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">savedWinUnits</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># draw everything except the marker:</span>
        <span class="k">for</span> <span class="n">visualElement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualDisplayElements</span><span class="p">:</span>
            <span class="n">visualElement</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="c1"># draw a fixed marker if the scale is being drawn after a response:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noResponse</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># fix the marker position on the line</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPosFixed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_setMarkerColor</span><span class="p">(</span><span class="s1">&#39;DarkGray&#39;</span><span class="p">)</span>

                <span class="c1"># drop it onto the line</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">setPos</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">.012</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">flipVert</span><span class="p">],</span>
                                   <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">markerPosFixed</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># flag to park it there</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAccept</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">acceptBox</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>  <span class="c1"># hides the text</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">setUnits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">savedWinUnits</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span>  <span class="c1"># makes the marker unresponsive</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noMouse</span><span class="p">:</span>
            <span class="n">mouseNearLine</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mouseX</span><span class="p">,</span> <span class="n">mouseY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myMouse</span><span class="o">.</span><span class="n">getPos</span><span class="p">()</span>  <span class="c1"># norm units</span>
            <span class="n">mouseNearLine</span> <span class="o">=</span> <span class="n">pointInPolygon</span><span class="p">(</span><span class="n">mouseX</span><span class="p">,</span> <span class="n">mouseY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nearLine</span><span class="p">)</span>

        <span class="c1"># draw a dynamic marker:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlaced</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">singleClick</span><span class="p">:</span>
            <span class="c1"># update position:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">singleClick</span> <span class="ow">and</span> <span class="n">mouseNearLine</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setMarkerPos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getMarkerFromPos</span><span class="p">(</span><span class="n">mouseX</span><span class="p">))</span>
            <span class="n">proportion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">tickMarks</span>
            <span class="c1"># expansion for &#39;glow&#39;, based on proportion of total line</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStyle</span> <span class="o">==</span> <span class="s1">&#39;glow&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerExpansion</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerExpansion</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">newSize</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerExpansion</span> <span class="o">*</span> <span class="n">proportion</span>
                    <span class="n">newOpacity</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="n">proportion</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># self.markerExpansion &lt; 0:</span>
                    <span class="n">newSize</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerExpansion</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">proportion</span><span class="p">)</span>
                    <span class="n">newOpacity</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="o">-</span> <span class="n">proportion</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">setSize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markerBaseSize</span> <span class="o">+</span> <span class="n">newSize</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">setOpacity</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">newOpacity</span><span class="p">)),</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># set the marker&#39;s screen position based on tick (==</span>
            <span class="c1"># markerPlacedAt)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetHoriz</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hStretchTotal</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">proportion</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">setPos</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerYpos</span><span class="p">),</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAccept</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedBySubject</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">100</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">acceptBox</span><span class="o">.</span><span class="n">setFillColor</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pulseColor</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">],</span> <span class="n">colorSpace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorSpace</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">acceptBox</span><span class="o">.</span><span class="n">setLineColor</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pulseColor</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">],</span> <span class="n">colorSpace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorSpace</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptTextColor</span><span class="p">,</span> <span class="n">colorSpace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorSpace</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showValue</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span><span class="p">)])</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">==</span> <span class="mi">60</span><span class="p">:</span>
                        <span class="n">valTmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span>
                        <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">valTmp</span><span class="p">)</span>  <span class="c1"># also works for hours:minutes</span>
                        <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">60.</span> <span class="o">*</span> <span class="p">(</span><span class="n">valTmp</span> <span class="o">-</span> <span class="n">minutes</span><span class="p">))</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmtStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">minutes</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">valTmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmtStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">valTmp</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoRescaleFactor</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptText</span><span class="p">)</span>

        <span class="c1"># handle key responses:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseOnly</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">getKeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allKeys</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skipKeys</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">noResponse</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRT</span><span class="p">()))</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">respKeys</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableRespKeys</span><span class="p">:</span>
                    <span class="c1"># place the marker at the corresponding tick (from key)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">markerPlaced</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedBySubject</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tickFromKeyPress</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getMarkerFromTick</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
                    <span class="n">proportion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">tickMarks</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">proportion</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlaced</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">beyondMinTime</span><span class="p">:</span>
                    <span class="c1"># placed by experimenter (as markerStart) or by subject</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedBySubject</span> <span class="ow">or</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyIncrement</span><span class="p">):</span>
                        <span class="c1"># inefficient to do every frame...</span>
                        <span class="n">leftIncr</span> <span class="o">=</span> <span class="n">rightIncr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyIncrement</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># markerStart is fractional; arrow keys move to next</span>
                        <span class="c1"># location</span>
                        <span class="n">leftIncr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyIncrement</span>
                        <span class="n">rightIncr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyIncrement</span> <span class="o">-</span> <span class="n">leftIncr</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">leftKeys</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">-</span> <span class="n">leftIncr</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedBySubject</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rightKeys</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">+</span> <span class="n">rightIncr</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedBySubject</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptKeys</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">acceptResponse</span><span class="p">(</span><span class="s1">&#39;key response&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
                    <span class="c1"># off the end?</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tickMarks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedBySubject</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">singleClick</span>
                        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">beyondMinTime</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">marker</span><span class="o">.</span><span class="n">setPos</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetVert</span><span class="p">),</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">acceptResponse</span><span class="p">(</span><span class="s1">&#39;key single-click&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>

        <span class="c1"># handle mouse left-click:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">noMouse</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">myMouse</span><span class="o">.</span><span class="n">getPressed</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="c1"># mouseX, mouseY = self.myMouse.getPos() # done above</span>
            <span class="c1"># if click near the line, place the marker there:</span>
            <span class="k">if</span> <span class="n">mouseNearLine</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">markerPlaced</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedBySubject</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getMarkerFromPos</span><span class="p">(</span><span class="n">mouseX</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">singleClick</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">beyondMinTime</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">acceptResponse</span><span class="p">(</span><span class="s1">&#39;mouse single-click&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
            <span class="c1"># if click in accept box and conditions are met, accept the</span>
            <span class="c1"># response:</span>
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">showAccept</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">markerPlaced</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">beyondMinTime</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">acceptBox</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">mouseX</span><span class="p">,</span> <span class="n">mouseY</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">acceptResponse</span><span class="p">(</span><span class="s1">&#39;mouse response&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStyle</span> <span class="o">==</span> <span class="s1">&#39;hover&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlaced</span><span class="p">:</span>
            <span class="c1"># &#39;hover&#39; --&gt; noMouse = False during init</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mouseNearLine</span> <span class="ow">or</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAtLast</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;targetWord&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">targetWord</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">textColor</span><span class="p">,</span> <span class="n">colorSpace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorSpace</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="c1"># self.targetWord.setHeight(self.textSizeSmall, log=False)</span>
                    <span class="c1"># # avoid TextStim memory leak</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">targetWord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">targetWord</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markerColor</span><span class="p">,</span> <span class="n">colorSpace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorSpace</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1"># skip size change to reduce mem leakage from pyglet text</span>
                <span class="c1"># self.targetWord.setHeight(1.05*self.textSizeSmall,log=False)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAtLast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">mouseNearLine</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">wasNearLine</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">targetWord</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">textColor</span><span class="p">,</span> <span class="n">colorSpace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorSpace</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1"># self.targetWord.setHeight(self.textSizeSmall, log=False)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wasNearLine</span> <span class="o">=</span> <span class="n">mouseNearLine</span>

        <span class="c1"># decision time = sec from first .draw() to when first &#39;accept&#39; value:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">noResponse</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">decisionTime</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decisionTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">log</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoLog</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;RatingScale </span><span class="si">%s</span><span class="s1">: rating RT=</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decisionTime</span><span class="p">))</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;RatingScale </span><span class="si">%s</span><span class="s1">: history=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHistory</span><span class="p">()))</span>
            <span class="c1"># minimum time is enforced during key and mouse handling</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">FINISHED</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAccept</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">acceptBox</span><span class="o">.</span><span class="n">setFillColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptFillColor</span><span class="p">,</span> <span class="n">colorSpace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorSpace</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">acceptBox</span><span class="o">.</span><span class="n">setLineColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptLineColor</span><span class="p">,</span> <span class="n">colorSpace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorSpace</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># build up response history if no decision or skip yet:</span>
            <span class="n">tmpRating</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRating</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">tmpRating</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedBySubject</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tmpRating</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRT</span><span class="p">()))</span>  <span class="c1"># tuple</span>

        <span class="c1"># restore user&#39;s units:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">setUnits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">savedWinUnits</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="RatingScale.reset">
<a class="viewcode-back" href="../../../../coder/RatingScale/#psychopy_legacy.visual.ratingscale.RatingScale.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Restores the rating-scale to its post-creation state.</span>

<span class="sd">        The history is cleared, and the status is set to NOT_STARTED. Does</span>
<span class="sd">        not restore the scale text description (such reset is needed between</span>
<span class="sd">        items when rating multiple items)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># only resets things that are likely to have changed when the</span>
        <span class="c1"># ratingScale instance is used by a subject</span>
        <span class="c1"># reset label color if using hover</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStyle</span> <span class="o">==</span> <span class="s1">&#39;hover&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">labels</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">textColor</span><span class="p">,</span> <span class="n">colorSpace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorSpace</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noResponse</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># restore in case it turned gray, etc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markerColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerColorOriginal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setMarkerColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markerColor</span><span class="p">)</span>
        <span class="c1"># placed by subject or markerStart: show on screen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markerPlaced</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># placed by subject is actionable: show value, singleClick</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedBySubject</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># NB markerStart could be 0; during __init__, its forced to be numeric</span>
        <span class="c1"># and valid, or None (not boolean)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerPlaced</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># __init__ assures this is valid:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerStart</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAtLast</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># unplaced</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wasNearLine</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firstDraw</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># -&gt; self.clock.reset() at start of draw()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decisionTime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markerPosFixed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># a counter used only to &#39;pulse&#39; the &#39;accept&#39; box</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAccept</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acceptBox</span><span class="o">.</span><span class="n">setFillColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptFillColor</span><span class="p">,</span> <span class="n">colorSpace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorSpace</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acceptBox</span><span class="o">.</span><span class="n">setLineColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptLineColor</span><span class="p">,</span> <span class="n">colorSpace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">colorSpace</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;#444444&#39;</span><span class="p">,</span> <span class="n">colorSpace</span><span class="o">=</span><span class="s1">&#39;hex&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># greyed out</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keyClick</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">log</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoLog</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="s1">&#39;RatingScale </span><span class="si">%s</span><span class="s1">: reset()&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">NOT_STARTED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="RatingScale.getRating">
<a class="viewcode-back" href="../../../../coder/RatingScale/#psychopy_legacy.visual.ratingscale.RatingScale.getRating">[docs]</a>
    <span class="k">def</span> <span class="nf">getRating</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the final, accepted rating, or the current value.</span>

<span class="sd">        The rating is None if the subject skipped this item, took longer</span>
<span class="sd">        than ``maxTime``, or no rating is</span>
<span class="sd">        available yet. Returns the currently indicated rating even if it has</span>
<span class="sd">        not been accepted yet (and so might change until accept is pressed).</span>
<span class="sd">        The first rating in the list will have the value of</span>
<span class="sd">        markerStart (whether None, a numeric value, or a choice value).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noResponse</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">FINISHED</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># eg, if skipped a response</span>

        <span class="c1"># set type for the response, based on what was wanted</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPlacedAt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoRescaleFactor</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="n">response</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
                <span class="c1"># == we have a numeric fractional choice from markerStart and</span>
                <span class="c1"># want to save the numeric value as first item in the history</span>
        <span class="k">return</span> <span class="n">response</span></div>


<div class="viewcode-block" id="RatingScale.getRT">
<a class="viewcode-back" href="../../../../coder/RatingScale/#psychopy_legacy.visual.ratingscale.RatingScale.getRT">[docs]</a>
    <span class="k">def</span> <span class="nf">getRT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the seconds taken to make the rating (or to indicate skip).</span>

<span class="sd">        Returns None if no rating available, or maxTime if the response</span>
<span class="sd">        timed out. Returns the time elapsed so far if no rating has been</span>
<span class="sd">        accepted yet (e.g., for continuous usage).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="n">FINISHED</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noResponse</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timedOut</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxTime</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decisionTime</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div>


<div class="viewcode-block" id="RatingScale.getHistory">
<a class="viewcode-back" href="../../../../coder/RatingScale/#psychopy_legacy.visual.ratingscale.RatingScale.getHistory">[docs]</a>
    <span class="k">def</span> <span class="nf">getHistory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of the subject&#39;s history as (rating, time) tuples.</span>

<span class="sd">        The history can be retrieved at any time, allowing for continuous</span>
<span class="sd">        ratings to be obtained in real-time. Both numerical and categorical</span>
<span class="sd">        choices are stored automatically in the history.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span></div>
</div>

</pre></div>

      <br/><a href="#" class="pull-right">Back to top</a>
    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <span class="pull-right">
      
        
      <br/>

          &copy; 2002-2018 <a href="https://www.peirce.org.uk/">Jonathan Peirce</a><br/>
          &copy; 2019 <a href="https://opensciencetools.org/">Open Science Tools Ltd.</a><br/><br/>
        PsychoPy<sup></sup> and Pavlovia<sup></sup> are registered trademarks of Open Science Tools Ltd.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.3.7.<br/><br/>
    </span>

    <a href="http://www.nottingham.ac.uk/"><img src="../../../../_static/Nottingham Supported.png", alt="Uni of Nottingham" width=250></a>
  </div>

</footer>
  </body>
</html>